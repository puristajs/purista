import {
  getCommandSuccessMessageMock,
  getEventBridgeMock,
  getLoggerMock,
  safeBind,
} from '@purista/core'
import { createSandbox } from 'sinon'

import { {{camelCase service.name}}V{{service.version}}Service } from '../../{{camelCase service.name}}V{{service.version}}Service{{fileExt}}'
import { {{camelCase name}}SubscriptionBuilder } from './{{camelCase name}}SubscriptionBuilder{{fileExt}}'
import { {{properCase service.name}}V{{service.version}}{{properCase name}}InputPayload, {{properCase service.name}}V{{service.version}}{{properCase name}}InputParameter } from './types{{fileExt}}'

describe('service {{properCase service.name}} version {{service.version}} - subscription {{camelCase name}}', () => {
  const sandbox = createSandbox()
  beforeEach(() => {
    // add your before each here
  })

  afterEach(() => {
    sandbox.restore()
  })

  test('does not throw', async () => {
    // create a service instance to be bind to the subscription function
    const service = await {{camelCase service.name}}V{{service.version}}Service.getInstance(getEventBridgeMock(sandbox).mock, {
      logger: getLoggerMock(sandbox).mock
    })

    // get the subscription function and bind to service instance to work properly
    const {{camelCase name}} = safeBind({{camelCase name}}SubscriptionBuilder.getSubscriptionFunction(), service)

    // define the test input payload
    const payload: {{properCase service.name}}V{{service.version}}{{properCase name}}InputPayload = undefined

    // define the test input parameter
    const parameter: {{properCase service.name}}V{{service.version}}{{properCase name}}InputParameter = undefined

    // create a mock message with the expected input for the subscription function
    const message = getCommandSuccessMessageMock(payload)

    // create a subscription context for the subscription function
    const context = {{camelCase name}}SubscriptionBuilder.getSubscriptionContextMock(message, sandbox)

    // execute the subscription function
    const result = await {{camelCase name}}(context.mock, payload, parameter)

    expect(result).toBeUndefined()
  })
})
