import{_ as s,c as i,o as e,V as a,a7 as t}from"./chunks/framework.ITQiifkM.js";const m=JSON.parse('{"title":"Add a Subscription","description":"Add the first subscription to your PURISTA service","frontmatter":{"title":"Add a Subscription","description":"Add the first subscription to your PURISTA service","order":105000,"image":"/graphic/add_subscription.png"},"headers":[],"relativePath":"handbook/1_quickstart/add-the-first-subscription.md","filePath":"handbook/1_quickstart/add-the-first-subscription.md","lastUpdated":1706444636000}'),n={name:"handbook/1_quickstart/add-the-first-subscription.md"},l=a('<h1 id="add-a-subscription" tabindex="-1">Add a subscription <a class="header-anchor" href="#add-a-subscription" aria-label="Permalink to &quot;Add a subscription&quot;">​</a></h1><p><img src="'+t+`" alt="Add subscription with cli"></p><p>A subscription is a function which will be triggered by messages and events, when the given criteria are matching. The producer of the message does not have knowledge about the subscription.</p><p>Subscriptions do not need to return a value. If a subscription is returning a value, it will be emitted as custom message to the event bridge. The subscription does not have any knowledge if the custom message has a consumer.</p><p>In our example, the subcription will be part of the &quot;Email&quot; domain. Because of this, we will first create a other service called &quot;Email&quot;.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">purista</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add service email</span></span></code></pre></div><p>Now, we can create a new subscription, which will be added to the email service.</p><h2 id="create-a-subscription" tabindex="-1">Create a subscription <a class="header-anchor" href="#create-a-subscription" aria-label="Permalink to &quot;Create a subscription&quot;">​</a></h2><p>For adding a subscription to a service, you can use the PURISTA CLI.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">purista</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add subscription</span></span></code></pre></div><p>The CLI will guide you through all steps and will create all files for you. In the first step, you will be asked for the name of the new subscription. We will start with <em>sendWelcomeEmail</em>.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> What is the name of the new subscription send welcome email</span></span></code></pre></div><p>As you can see, it is possible to enter the name of the subscription in a very natural way. The CLI tool will handle the naming conventions for you. Subscription names will be camel-case.</p><div class="tip custom-block"><p class="custom-block-title">Try to use a subscription name, which is:</p><ul><li>global unique (a subscription in different service versions should have the same name)</li><li>short, but speaking &amp; understandable</li><li>use simple present, like <code>sendWelcomeEmail</code> or <code>triggerWorkflow</code></li><li>try to standard prefixes, like <code>createBankAccount</code> or <code>updateUserProfile</code></li></ul></div><p>After you have confirmed your input by pressing the enter key, you will be asked for a short description of the subscription.</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> What is the matter of subscription </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;sendWelcomeEmail&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> send a welcome mail to new registered users</span></span></code></pre></div><p>Here, you should enter some short, general description, which will be used for some human-facing documentation. So, please provide here something like: <em>send a welcome mail to new registered users</em>.</p><p>In the next step, you will be asked to select an event name. Then subscription will be triggered as soon as an event with given name is sent.</p><p>After selecting the event name, you must select the service. Use the arrow keys to select the service (and version), on which the new command should be registered. In our example, choose <em>User</em> .</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a service email 1</span></span></code></pre></div><p>Confirm your choice by pressing the enter key.</p><p>Now, the files will be created, the event name will be added as a new enum entry and the command will be added to the command list of the service.</p><h2 id="structure" tabindex="-1">Structure <a class="header-anchor" href="#structure" aria-label="Permalink to &quot;Structure&quot;">​</a></h2><p>A folder for the new subscription is created - in our example it is <code>src/service/user/v1/subscription/sendWelcomeEmail</code>. Here, you can find, all files relating to this single subscription function.</p><p>The structure follows the same pattern as for command functions.</p><h2 id="subscription-builder-file" tabindex="-1">Subscription builder file <a class="header-anchor" href="#subscription-builder-file" aria-label="Permalink to &quot;Subscription builder file&quot;">​</a></h2><p>The main file for a subscription is the subscription builder file - <code>sendWelcomeEmailSubscriptionBuilder.ts</code> in our example. As you can see, the CLI tool already added some configuration properties - the ones you normally always have for a subscription.</p><p>The implementation of the business logic should be done in this file.</p><div class="vp-code-group vp-adaptive-theme"><div class="tabs"><input type="radio" name="group-0gNiL" id="tab-EpmcjtD" checked="checked"><label for="tab-EpmcjtD">sendWelcomeEmailSubscriptionBuilder.ts</label></div><div class="blocks"><div class="language-typescript vp-adaptive-theme active"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { ServiceEvent } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../../../../ServiceEvent.enum&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { emailV1ServiceBuilder } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;../../emailV1ServiceBuilder&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { emailV1SendWelcomeEmailInputPayloadSchema } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;./schema&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sendWelcomeEmailSubscriptionBuilder</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> emailV1ServiceBuilder</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getSubscriptionBuilder</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;sendWelcomeEmail&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;send a welcome mail to new registered users&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subscribeToEvent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ServiceEvent.NewUserRegistered)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addPayloadSchema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(emailV1SendWelcomeEmailInputPayloadSchema)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setSubscriptionFunction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_payload</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">_parameter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // add your business logic here</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span></code></pre></div></div></div><div class="info custom-block"><p class="custom-block-title">More on subscription builder usage:</p><ul><li><a href="./../2_building_business-logic/subscription/the-subscription-builder.html">Subscription builder</a></li><li><a href="./../../api/classes/purista_core.SubscriptionDefinitionBuilder.html#methods">API documentation: SubscriptionDefinitionBuilder - Methods</a></li></ul></div>`,30),r=[l];function p(h,o,d,c,u,k){return e(),i("div",null,r)}const g=s(n,[["render",p]]);export{m as __pageData,g as default};
